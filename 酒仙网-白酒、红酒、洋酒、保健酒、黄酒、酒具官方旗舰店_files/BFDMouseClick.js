/*! hotlink update 2015-06-30 by xuefeng.han */
!function(){function MouseClick(options){this.options=options||{security:"1",hook:"bfd_hook"},this.inited=!1,this.location_ctrl=new LocationCtrl}function readXPath(element){if(""!==element.id)return'//*[@id="'+element.id+'"]';if(element==document.body)return"/html/"+element.tagName;for(var ix=0,siblings=element.parentNode.childNodes,i=0,l=siblings.length;l>i;i++){var sibling=siblings[i];if(sibling==element)return arguments.callee(element.parentNode)+"/"+element.tagName+(ix+1==1?"":"["+(ix+1)+"]");1==sibling.nodeType&&sibling.tagName==element.tagName&&ix++}}function getHref(ele){if(/a/i.test(ele.tagName)){var href = ele.getAttribute("href")==null?ele.parentNode.getAttribute("href"):ele.getAttribute("href");return!href||"#"==href.replace(window.location.protocol+"//"+window.location.host+"/","")||/^(javascript)/.test(href)?null:/^http(s)?:\/\//.test(href)?href:window.location.protocol+"//"+window.location.host+("/"===href.charAt(0)?"":"/")+href}return ele==document.body?null:arguments.callee(ele.parentNode)}function loadScript(src,callback){var s=document.createElement("script");s.type="text/"+(src.type||"javascript"),s.src=src.src||src,s.async=!1,s.onreadystatechange=s.onload=function(){var state=s.readyState;callback.done||state&&!/loaded|complete/.test(state)||(callback.done=!0,callback())},(document.getElementsByTagName("body")[0]||document.getElementsByTagName("head")[0]).appendChild(s)}function LocationCtrl(){this.url=window.location.href,this.hash=window.location.hash,this.mode=0,/^(#clickhot)/.test(this.hash)&&(this.mode=1),this.getMode=function(){return this.mode}}BCore.exts.MouseClick2=MouseClick,MouseClick.prototype={begin:function(){if(this.inited!==!0){this.inited=!0;var me=this;var mode=this.location_ctrl.getMode();switch(mode){case 0:this.bindMouseClick();break;case 1:if(window.addEventListener){window.addEventListener("message", function (e){me.show_heatlink(e.data)})}else{window.attachEvent("onmessage", function (e){me.show_heatlink(e.data)})}window.parent.postMessage(JSON.stringify({loaded : true}), "*");break;}}},show_heatlink:function(p){try{var param=eval("("+p+")");loadScript("http://passport.baifendian.com/graphweb/js/dist/client/show_heatlink.js",function(){new BFD_HotLinkMask(param)})}catch(e){}},bindMouseClick:function(){function mouseDownHandler(e){try{var hook_id,ev=e||window.event,t=ev.target||ev.srcElement;switch(Number(_this.options.security)){case 0:if("undefined"==typeof _this.options.hook||""===_this.options.hook)return;if(hook_id=t.getAttribute(_this.options.hook),void 0===hook_id||null===hook_id)return;break;case 1:"undefined"!=typeof _this.options.hook&&""!==_this.options.hook&&(hook_id=t.getAttribute(_this.options.hook));break;default:return}var href=getHref(t);if((ev.button||0===ev.button)&&1!==ev.button&&0!==ev.button)return;if(!href)return;var _st=document.body.scrollTop||document.documentElement.scrollTop,offsetX=(document.documentElement.offsetWidth,document.documentElement.clientHeight,ev.clientX),offsetY=ev.clientY+_st,source=window.location.href;/[#\?]/.test(source[source.length-1])&&(source=source.substring(0,source.length-1));var xpath=readXPath(t),param={pth:xpath,lt:offsetX,tp:offsetY,ep:source,ln:href,hook:hook_id};_this.sendReq(param)}catch(e){}}var _this=this,Tools=BCore.tools.Tools;Tools.bind(document,"mousedown",mouseDownHandler)},sendReq:function(param){new BCore(function(){var mc=new BCore.inputs.UserAction("LinkClick"),md=new BCore.inputs.UserAction("LinkClick");for(var prop in param)mc[prop]=param[prop],md[prop]=param[prop];var rs=new BCore.exts.RequestSave;rs.save(mc),this.send(md,function(){var Tools=BCore.tools.Tools;Tools.setCookie("request_temp_url","",-1)})})}}}();